<script>
        // Globalt state
        let allData = [];
        let mainTableSort = { column: 'namn', order: 'asc' };
        
        // Paginering state
        let currentPage = 1;
        
        // *** ÄNDRING 1: Byt från 'const' till 'let' och sätt en fallback ***
        let rowsPerPage = 100; 

        // Körs när sidan laddats
        document.addEventListener('DOMContentLoaded', () => {
            // *** ÄNDRING 2: Anropa vår nya start-funktion ***
            initializeApp();
        });

        /**
         * *** NY FUNKTION ***
         * Hämta först konfigurationen, kör sedan appen.
         */
        async function initializeApp() {
            try {
                // Steg 1: Hämta konfiguration från /config
                // Detta anrop kommer nu att fångas av din [[catchall]].js
                const configResponse = await fetch('/config'); 
                
                if (configResponse.ok) {
                    const config = await configResponse.json();
                    rowsPerPage = config.rowsPerPage || 100; 
                } else {
                    console.warn('Kunde inte hämta /config. Använder standardvärde.');
                }
            } catch (error) {
                console.error('Kunde inte ladda app-konfiguration:', error);
            }

            // Steg 2: Kör resten av app-logiken (som förut)
            initApp(); // Denna hämtar /data.json
            addEventListeners();
            setupThemeToggle();
        }


        /**
         * Hämta data och initiera appen
         * (Denna funktion är oförändrad, men anropas nu av initializeApp)
         */
        async function initApp() {
            // ... (din initApp-kod här, precis som den var) ...
        }
        
        // ... (resten av alla dina funktioner) ...
    </script>
